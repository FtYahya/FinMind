<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FinMind Sniper – 5 Stock Quant Engine</title>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#000; color:#e5e7eb; font-family: monospace; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

const { useState, useRef } = React;

function App(){

const [apiKey,setApiKey] = useState("");
const [capital,setCapital] = useState(100000);
const [status,setStatus] = useState("IDLE");
const [results,setResults] = useState([]);
const [error,setError] = useState("");
const [cooldown,setCooldown] = useState(false);

const controllerRef = useRef(null);

// MARKET HOURS CHECK
function isMarketOpen(){
const now = new Date();
const day = now.getDay();
if(day===0 || day===6) return false;

const hour = now.getHours();
const min = now.getMinutes();

const open = (hour>9 || (hour===9 && min>=15));
const close = (hour<15 || (hour===15 && min<=30));

return open && close;
}

// CONFIDENCE ENGINE
function computeConfidence(d){
let score = 0;
if(d.volumeSpike>150) score+=30;
if(d.rsi>=55 && d.rsi<=70) score+=20;
if(d.breakout) score+=25;
if(d.newsRecent) score+=25;
return score;
}

// POSITION SIZE
function positionSize(entry,stop){
const riskPerTrade = capital * 0.01;
const diff = Math.abs(entry-stop);
if(diff===0) return 0;
return Math.floor(riskPerTrade/diff);
}

async function scan(){

setError("");
setResults([]);

if(!apiKey) return setError("Enter API Key");
if(!isMarketOpen()) return setError("Market Closed");
if(cooldown) return setError("Wait 30 seconds");

setCooldown(true);
setTimeout(()=>setCooldown(false),30000);

if(controllerRef.current) controllerRef.current.abort();
controllerRef.current = new AbortController();

setStatus("SCANNING");

const prompt = `
Return STRICT JSON ONLY.

{
"stocks":[
{
"name":"",
"price":number,
"rsi":number,
"volumeSpike":number,
"breakout":true/false,
"newsRecent":true/false,
"target":number,
"stopLoss":number,
"action":"BUY or SHORT"
}
]
}

TASK:
Scan NSE market RIGHT NOW.
Return EXACTLY 5 stocks with strongest intraday breakout potential.
Only include active high-volume stocks.
`;

try{

const res = await fetch(
`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,
{
method:"POST",
headers:{"Content-Type":"application/json"},
signal: controllerRef.current.signal,
body: JSON.stringify({
contents:[{parts:[{text:prompt}]}],
tools:[{google_search:{}}]
})
}
);

const data = await res.json();
let text = data.candidates?.[0]?.content?.parts?.[0]?.text;

if(!text) throw new Error("Empty response");

// CLEAN JSON
text = text.replace(/```json/g,"")
.replace(/```/g,"")
.trim();

const firstBrace = text.indexOf("{");
const lastBrace = text.lastIndexOf("}");
if(firstBrace===-1 || lastBrace===-1)
throw new Error("Invalid AI format");

text = text.substring(firstBrace,lastBrace+1);

const parsed = JSON.parse(text);

if(!parsed.stocks || parsed.stocks.length===0)
throw new Error("No stocks returned");

let finalStocks = [];

parsed.stocks.forEach(stock=>{
const confidence = computeConfidence(stock);
if(confidence>=70){
finalStocks.push({
...stock,
confidence,
quantity: positionSize(stock.price,stock.stopLoss)
});
}
});

if(finalStocks.length===0)
throw new Error("No high-confidence trades found");

// SORT BY CONFIDENCE
finalStocks.sort((a,b)=>b.confidence-a.confidence);

setResults(finalStocks.slice(0,5));
setStatus("IDLE");

}catch(e){
setError(e.message);
setStatus("ERROR");
}

}

return(
<div className="p-6 space-y-4 max-w-2xl mx-auto">

<h1 className="text-orange-500 text-xl font-bold">
FinMind Sniper – 5 Stock Quant Engine
</h1>

<input
type="password"
placeholder="Gemini API Key"
className="bg-gray-900 p-3 w-full rounded"
value={apiKey}
onChange={e=>setApiKey(e.target.value)}
/>

<input
type="number"
placeholder="Capital"
className="bg-gray-900 p-3 w-full rounded"
value={capital}
onChange={e=>setCapital(Number(e.target.value))}
/>

<button
onClick={scan}
disabled={status==="SCANNING"}
className="bg-orange-600 w-full p-3 rounded font-bold"
>
{status==="SCANNING" ? "Scanning Market..." : "Scan NSE for 5 Trades"}
</button>

{error && (
<div className="text-red-500 bg-gray-900 p-3 rounded">{error}</div>
)}

{results.length>0 && (
<div className="space-y-4">
{results.map((r,i)=>(
<div key={i} className="bg-gray-900 p-4 rounded text-sm space-y-1">
<div className="text-orange-500 font-bold">
#{i+1} {r.name} ({r.confidence}%)
</div>
<div>Price: {r.price}</div>
<div>Action: {r.action}</div>
<div>Target: {r.target}</div>
<div>Stop: {r.stopLoss}</div>
<div>Position Size: {r.quantity}</div>
</div>
))}
</div>
)}

</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>
