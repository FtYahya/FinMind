<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinMind Sniper: High-Profit Edition</title>
    
    <!-- React & ReactDOM (The Engine) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (To understand the code) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS (For styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom Scrollbar for that Hacker Feel */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #ea580c; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { background-color: #000; color: #e5e7eb; }
        
        /* Scan Line Animation */
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .scan-line {
            position: absolute;
            left: 0; right: 0; height: 2px;
            background: rgba(234, 88, 12, 0.5);
            animation: scan 2s linear infinite;
            pointer-events: none;
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="root" class="h-screen w-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. CRASH-PROOF ICONS (Inline SVGs) ---
        // This replaces the external library that was causing white screens.
        const Icon = ({ path, size = 18, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Terminal: (props) => <Icon {...props} path={<><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></>} />,
            Activity: (props) => <Icon {...props} path={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>} />,
            Search: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>} />,
            Zap: (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            Clock: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            ShieldCheck: (props) => <Icon {...props} path={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></>} />,
            AlertTriangle: (props) => <Icon {...props} path={<><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />,
            Lock: (props) => <Icon {...props} path={<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />
        };

        // --- 2. COMPONENTS ---

        const Header = ({ status }) => (
            <div className="bg-[#050505] border-b border-gray-800 p-3 sticky top-0 z-20 flex justify-between items-center shadow-lg shadow-orange-900/5">
                <div className="flex flex-col">
                    <h1 className="text-lg font-bold text-gray-100 tracking-tighter flex items-center gap-2">
                        FinMind<span className="text-orange-600 font-black">SNIPER</span>
                    </h1>
                    <div className="text-[9px] text-gray-500 font-mono flex items-center gap-2 tracking-widest">
                        {status === 'IDLE' && <div className="w-1.5 h-1.5 bg-green-500 rounded-full"></div>}
                        {status === 'SCANNING' && <div className="w-1.5 h-1.5 bg-orange-500 rounded-full animate-ping"></div>}
                        {status === 'ERROR' && <div className="w-1.5 h-1.5 bg-red-500 rounded-full"></div>}
                        {status === 'SCANNING' ? 'HUNTING 25% RETURNS...' : 'SYSTEM ARMED'}
                    </div>
                </div>
                <div className="bg-orange-900/10 border border-orange-900/30 px-2 py-1 rounded flex items-center gap-1.5">
                    <Icons.Target size={10} className="text-orange-500" />
                    <span className="text-[9px] text-orange-400 font-mono font-bold">ROI TARGET: MAX</span>
                </div>
            </div>
        );

        const TradeView = ({ ticker, setTicker, executeGrandmasterScan, status, output, bottomRef }) => (
            <div className="flex flex-col h-full bg-black relative">
                {status === 'SCANNING' && <div className="scan-line"></div>}
                
                {/* CONTROLS */}
                <div className="p-4 bg-gradient-to-b from-gray-900/40 to-black border-b border-gray-800 space-y-4">
                    
                    {/* Input Row */}
                    <div className="flex gap-2">
                        <div className="relative flex-1 group">
                            <div className="absolute left-3 top-3 text-gray-600 group-focus-within:text-orange-500 transition-colors">
                                <Icons.Search size={16} />
                            </div>
                            <input 
                                value={ticker}
                                onChange={(e) => setTicker(e.target.value)}
                                placeholder="ENTER TICKER (e.g. ADANIENT)"
                                className="w-full bg-[#0a0a0a] border border-gray-800 text-white pl-10 pr-4 py-3 rounded-md focus:border-orange-600 focus:outline-none font-mono uppercase tracking-wider text-sm transition-all"
                                onKeyDown={(e) => e.key === 'Enter' && executeGrandmasterScan('TARGET')}
                            />
                        </div>
                        <button 
                            onClick={() => executeGrandmasterScan('TARGET')}
                            disabled={status === 'SCANNING' || !ticker}
                            className="bg-gray-800 hover:bg-gray-700 text-gray-200 border border-gray-700 px-5 rounded-md font-bold text-xs tracking-wide transition-all uppercase disabled:opacity-50"
                        >
                            VERIFY
                        </button>
                    </div>

                    {/* The Big "Jackpot" Button */}
                    <button 
                        onClick={() => executeGrandmasterScan('SCAN')}
                        disabled={status === 'SCANNING'}
                        className="group relative w-full flex items-center justify-between bg-orange-700 hover:bg-orange-600 disabled:opacity-50 disabled:bg-gray-800 text-white py-4 px-6 rounded-md transition-all overflow-hidden shadow-lg shadow-orange-900/20"
                    >
                        <div className="flex flex-col items-start z-10">
                            <span className="text-sm font-black italic tracking-widest uppercase flex items-center gap-2">
                                <Icons.Target size={16} />
                                SCAN FOR 5 "JACKPOT" TRADES
                            </span>
                            <span className="text-[9px] text-orange-200 font-mono mt-1 opacity-80">
                                CRITERIA: 20-25% POTENTIAL â€¢ UPPER CIRCUITS
                            </span>
                        </div>
                        <div className="z-10 bg-black/20 p-2 rounded-full group-hover:bg-black/10 transition-colors">
                            {status === 'SCANNING' ? <div className="animate-spin"><Icons.Activity size={20} /></div> : <Icons.Zap size={20} className="fill-white" />}
                        </div>
                    </button>

                    {/* Safety Badge */}
                    <div className="flex items-center gap-2 justify-center opacity-40">
                         <Icons.AlertTriangle size={10} className="text-red-500"/>
                         <span className="text-[9px] text-gray-500 font-mono">HIGH VOLATILITY MODE. STOP LOSS MANDATORY.</span>
                    </div>
                </div>

                {/* FEED AREA */}
                <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-24 scrollbar-hide">
                    {output.length === 0 && (
                        <div className="flex flex-col items-center justify-center h-48 text-gray-700 space-y-3 select-none">
                            <Icons.Target size={40} />
                            <p className="text-[10px] font-mono tracking-[0.2em]">AWAITING HIGH-ROI TARGETS</p>
                        </div>
                    )}
                    
                    {output.map((item) => (
                        <div key={item.id} className="bg-[#0b0b0b] border border-gray-800 rounded-sm overflow-hidden animate-in fade-in slide-in-from-bottom-3 duration-500">
                            <div className="bg-gray-900/80 px-4 py-2 border-b border-gray-800 flex justify-between items-center">
                                <div className="flex items-center gap-2">
                                    <div className="w-1.5 h-1.5 bg-orange-500 rounded-full animate-pulse"></div>
                                    <span className="text-xs font-bold text-gray-200 font-mono tracking-widest">{item.header}</span>
                                </div>
                                <div className="flex items-center gap-1.5 opacity-60">
                                    <Icons.Clock size={10} className="text-gray-400" />
                                    <span className="text-[9px] font-mono text-gray-400">{item.timestamp}</span>
                                </div>
                            </div>
                            
                            <div className={`p-5 text-sm font-mono leading-relaxed whitespace-pre-wrap ${item.isError ? 'text-red-400' : 'text-gray-300'}`}>
                                {item.loading ? (
                                    <div className="flex flex-col gap-2">
                                        <span className="animate-pulse tracking-wider text-xs">{item.body}</span>
                                        <div className="h-0.5 w-full bg-gray-800 overflow-hidden">
                                            <div className="h-full bg-orange-600 animate-pulse w-1/3"></div>
                                        </div>
                                        <div className="text-[9px] text-gray-600 mt-1">
                                            1. FILTERING FOR VOLATILITY &gt; 20%... <br/>
                                            2. CHECKING F&O BREAKOUTS... <br/>
                                            3. VERIFYING "GRANDMASTER" SAFETY... <br/>
                                            4. LOCKING 5 TARGETS...
                                        </div>
                                    </div>
                                ) : (
                                    <div className="whitespace-pre-wrap font-mono text-xs">
                                        {item.body}
                                    </div>
                                )}
                            </div>
                        </div>
                    ))}
                    <div ref={bottomRef}></div>
                </div>
            </div>
        );

        const LogsView = ({ logs }) => (
            <div className="bg-[#050505] h-full p-4 font-mono text-[10px] overflow-y-auto pb-20">
                <div className="text-orange-500/50 border-b border-orange-900/20 pb-2 mb-2 font-bold tracking-widest">SNIPER LOGS</div>
                {logs.map((log, i) => (
                    <div key={i} className="mb-1.5 flex gap-3 border-l border-gray-800 pl-3 hover:bg-white/5 p-1 transition-colors">
                        <span className="text-gray-600 shrink-0">{log.time}</span>
                        <span className={`shrink-0 font-bold ${
                            log.type === 'ERR' ? 'text-red-500' : 
                            log.type === 'ACK' ? 'text-green-500' : 
                            'text-orange-500'
                        }`}>[{log.type}]</span>
                        <span className="text-gray-400 break-all">{log.msg}</span>
                    </div>
                ))}
            </div>
        );

        // --- 3. API KEY MODAL (Essential for Netlify) ---
        const ApiKeyModal = ({ setKey }) => {
            const [input, setInput] = useState('');
            return (
                <div className="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
                    <div className="bg-gray-900 border border-gray-800 p-6 rounded-lg max-w-md w-full shadow-2xl">
                        <div className="flex items-center gap-3 mb-4 text-orange-500">
                            <Icons.Lock size={24} />
                            <h2 className="text-xl font-bold tracking-tighter">SECURITY CLEARANCE</h2>
                        </div>
                        <p className="text-gray-400 text-sm mb-4">
                            Enter your Google Gemini API Key to activate the Sniper System. 
                            <br/><span className="text-xs opacity-50">Keys are stored locally in your browser.</span>
                        </p>
                        <input 
                            type="password"
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            placeholder="Paste Key Here (sk-...)"
                            className="w-full bg-black border border-gray-700 p-3 rounded text-white font-mono text-sm mb-4 focus:border-orange-500 focus:outline-none"
                        />
                        <button 
                            onClick={() => { if(input.trim()) setKey(input.trim()) }}
                            className="w-full bg-orange-600 hover:bg-orange-500 text-white py-3 rounded font-bold tracking-widest transition-colors"
                        >
                            ACTIVATE SYSTEM
                        </button>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" className="block text-center mt-4 text-xs text-blue-400 hover:underline">
                            Get Free API Key &rarr;
                        </a>
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APPLICATION ---

        function FinMindApp() {
            const [activeTab, setActiveTab] = useState('trade');
            const [ticker, setTicker] = useState('');
            const [output, setOutput] = useState([]); 
            const [status, setStatus] = useState('IDLE'); 
            const [logs, setLogs] = useState([]);
            
            // Check for saved key
            const [userApiKey, setUserApiKey] = useState(localStorage.getItem('finmind_api_key') || '');
            
            const bottomRef = useRef(null);

            const addLog = (type, msg) => {
                const now = new Date();
                const time = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
                setLogs(prev => [...prev, { time, type, msg }]);
            };

            useEffect(() => {
                if (userApiKey) {
                    localStorage.setItem('finmind_api_key', userApiKey);
                    addLog('SYS', 'Grandmaster Sniper Initialized.');
                    addLog('CFG', 'Target Strategy: UPPER_CIRCUIT_HUNT (25%).');
                }
            }, [userApiKey]);

            useEffect(() => {
                if (bottomRef.current) bottomRef.current.scrollIntoView({ behavior: 'smooth' });
            }, [output]);

            // --- THE CORE LOGIC (Your "Text File 1" Logic) ---
            const executeGrandmasterScan = async (mode) => {
                if (status === 'SCANNING') return;
                
                const now = new Date();
                const dateStr = now.toDateString();
                const timeStr = now.toTimeString().split(' ')[0];
                let prompt = "";
                let displayHeader = "";

                if (mode === 'SCAN') {
                    // This is the EXACT prompt for High Profit / 5 Stocks
                    prompt = `
                        CURRENT TIME: ${dateStr} ${timeStr} IST.
                        MARKET: INDIAN STOCK MARKET (NSE).
                        TASK: Perform a "GRANDMASTER SNIPER" Scan to find EXACTLY 5 STOCKS with MAXIMUM PROFIT POTENTIAL.
                        CRITICAL CRITERIA (The "25%" Rule):
                        1. VOLATILITY: Look for stocks capable of 15-20%+ moves today (Upper Circuit candidates or F&O Breakouts).
                        2. SAFETY CHECK: Even though we want high profit, ensure Volume is real.
                        3. CATALYST: Must have a reason to explode (News/Results).
                        OUTPUT FORMAT:
                        Identify EXACTLY 5 "High-ROI" Stocks.
                        For each of the 5 stocks:
                        STOCK: [Name]
                        POTENTIAL: [Expected % Move]
                        ACTION: [BUY / SHORT]
                        ENTRY RANGE: [Price]
                        TARGET: [Aggressive Price]
                        STOP LOSS: [Strict]
                        REASON: [Why will it hit upper circuit?]
                    `;
                    displayHeader = "SNIPER_SCAN_25_PERCENT_PROTOCOL";
                } else {
                    if (!ticker.trim()) return;
                    prompt = `
                        CURRENT TIME: ${dateStr} ${timeStr} IST.
                        STOCK: ${ticker.toUpperCase()} (NSE).
                        TASK: Verify this stock for "High Profit" Intraday Trade.
                        CHECKLIST:
                        1. Does it have the volatility to give >10% returns today?
                        2. Is it safe or manipulated?
                        OUTPUT:
                        VERDICT: [SAFE TO TRADE / AVOID]
                        ACTION: [BUY / SHORT]
                        VOLATILITY RATING: [Low/Medium/High]
                        REASON: [Data-backed reason]
                        LEVELS: [Entry/Target/Stop]
                    `;
                    displayHeader = `VERIFYING: ${ticker.toUpperCase()}`;
                }

                setStatus('SCANNING');
                addLog('CMD', `Executing ${mode} Protocol...`);
                
                const newEntryId = Date.now();
                setOutput(prev => [...prev, { 
                    id: newEntryId, 
                    header: displayHeader, 
                    timestamp: timeStr,
                    body: "INITIATING HIGH-ROI SCAN...\n> FILTERING FOR UPPER CIRCUITS...\n> CALCULATING 25% POTENTIAL...\n> VERIFYING 5 TARGETS...", 
                    loading: true 
                }]);

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: prompt }] }],
                            tools: [{ google_search: {} }] 
                        })
                    });

                    if (!response.ok) {
                        const errData = await response.json();
                        throw new Error(errData.error?.message || `HTTP Error: ${response.status}`);
                    }

                    const data = await response.json();
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!aiText) throw new Error("No data received.");

                    const cleanText = aiText.replace(/\*\*/g, "").replace(/\*/g, "-"); 

                    setOutput(prev => prev.map(item => 
                        item.id === newEntryId 
                            ? { ...item, body: cleanText, loading: false } 
                            : item
                    ));
                    
                    setStatus('IDLE');
                    addLog('ACK', `Scan Complete. Targets Found.`);

                } catch (error) {
                    console.error(error);
                    setOutput(prev => prev.map(item => 
                        item.id === newEntryId 
                            ? { ...item, body: `SCAN FAILED: ${error.message}`, isError: true, loading: false } 
                            : item
                    ));
                    setStatus('ERROR');
                    addLog('ERR', `Failed: ${error.message}`);
                }
            };

            // If no API Key, show Modal
            if (!userApiKey) {
                return <ApiKeyModal setKey={setUserApiKey} />;
            }

            // Normal Render
            return (
                <>
                    <Header status={status} />
                    
                    <main className="flex-1 overflow-hidden relative">
                        {activeTab === 'trade' && (
                            <TradeView 
                                ticker={ticker} 
                                setTicker={setTicker} 
                                executeGrandmasterScan={executeGrandmasterScan} 
                                status={status} 
                                output={output}
                                bottomRef={bottomRef}
                            />
                        )}
                        {activeTab === 'logs' && <LogsView logs={logs} />}
                    </main>

                    <nav className="bg-[#050505] border-t border-gray-800 flex justify-center gap-8 p-2 pb-6 z-30">
                        <button onClick={() => setActiveTab('trade')} className={`w-16 py-2 rounded flex flex-col items-center gap-1 transition-all ${activeTab === 'trade' ? 'text-orange-500 scale-105' : 'text-gray-600 hover:text-gray-400'}`}>
                            <Icons.Activity size={18} />
                            <span className="text-[9px] font-bold tracking-widest">TRADE</span>
                        </button>
                        <button onClick={() => setActiveTab('logs')} className={`w-16 py-2 rounded flex flex-col items-center gap-1 transition-all ${activeTab === 'logs' ? 'text-orange-500 scale-105' : 'text-gray-600 hover:text-gray-400'}`}>
                            <Icons.Terminal size={18} />
                            <span className="text-[9px] font-bold tracking-widest">LOGS</span>
                        </button>
                    </nav>
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinMindApp />);
    </script>
</body>
</html>


